{"version":3,"sources":["Utils.tsx","Choosers.tsx","Storage.tsx","App.tsx","Stops.tsx","Schools.tsx","serviceWorker.ts","index.tsx"],"names":["DateUtils","Date","DeveloperUtils","URLSearchParams","window","location","search","get","DEVELOPER_QUERY_PARAM","IS_DEVELOPER_VALUE","timestamp","now","getTime","coords","FAKE_COORDINATES","accuracy","altitude","altitudeAccuracy","heading","latitude","longitude","speed","FAKE_RUN","school","name","routes","stops","route","leaders","start","arrivals","stop","position","LocationUtils","Promise","resolve","reject","navigator","geolocation","getCurrentPosition","error","isDeveloper","fakePosition","POSITION_OPTIONS","maximumAge","timeout","enableHighAccuracy","RunPersistence","run","body","JSON","stringify","TableName","Item","school_route","fetch","ENDPOINT","method","mode","TABLE_NAME","then","response","json","responseJSON","Items","catch","reason","console","log","LeaderChooserMode","Storage","key","localStorage","getItem","value","setItem","SchoolChooser","schools","this","props","map","className","onClick","callback","React","Component","RouteChooser","LeaderChooser","LEADER_STORAGE_KEY","leader","put","cached","getCachedLeaderName","message","Add","prompt","cacheLeaderName","onButtonPress","AppMode","ArrivedStop","arrival","toISOString","NextStop","onArrival","PendingStop","SCHOOLS","initialState","WATCH","Array","previous","App","state","listOpenRuns","onPreviousRuns","stopWatch","undefined","watch","setInterval","LEAD","setState","clearInterval","onLeaderAdded","emitRunUpdate","concat","leaderIndex","filter","_","index","here","length","end","options","type","blob","Blob","element","document","createElement","setAttribute","URL","createObjectURL","filename","style","display","appendChild","click","removeChild","download","i","join","lastStop","onPreviousJoin","startWatch","onCreateNew","onSchoolChosen","onRouteChosen","First","onLeaderChosen","numLeaders","removeButton","onLeaderRemoved","elements","push","nextStop","onDownloadPressed","Boolean","hostname","match","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.975504f5.chunk.js","sourcesContent":["import { RunModel } from './Models';\n\n/** Helper class to encapsulate Date methods */\nclass DateUtils {\n  /** Helper that returns the current date */\n  public static now(): Date {\n    return new Date();\n  }\n}\n\nclass DeveloperUtils {\n  static DEVELOPER_QUERY_PARAM: string = 'developer';\n  static IS_DEVELOPER_VALUE: string = '1';\n\n  static FAKE_COORDINATES: Coordinates = {\n    accuracy: 1,\n    altitude: 2,\n    altitudeAccuracy: 3,\n    heading: 4,\n    latitude: 5,\n    longitude: 6,\n    speed: 7\n  }\n\n  static FAKE_RUN: RunModel = {\n    school: {\n      name: 'Fake School',\n      routes: [{\n        name: 'Fake Route',\n        stops: [{\n          name: 'Fake Stop A'\n        }, {\n          name: 'Fake Stop B'\n        }]\n      }]\n    },\n    route: {\n      name: 'Fake Route',\n      stops: [{\n        name: 'Fake Stop A'\n      }, {\n        name: 'Fake Stop B'\n      }]\n    },\n    leaders: [{ name: 'me' }],\n    start: DateUtils.now(),\n    arrivals: [{\n      stop: {\n        name: 'Fake Stop A'\n      },\n      timestamp: DateUtils.now(),\n      position: {\n        coords: DeveloperUtils.FAKE_COORDINATES,\n        timestamp: DateUtils.now().getTime()\n      }\n    }]\n  }\n\n  public static isDeveloper(): boolean {\n    const developerValue: string = new URLSearchParams(window.location.search).get(DeveloperUtils.DEVELOPER_QUERY_PARAM) || '0';\n    return developerValue === DeveloperUtils.IS_DEVELOPER_VALUE;\n  }\n\n  public static fakePosition(): Position {\n    return { timestamp: DateUtils.now().getTime(), coords: DeveloperUtils.FAKE_COORDINATES};\n  }\n}\n\n/** Helper class to encapsulate Geolocation methods */\nclass LocationUtils {\n  static POSITION_OPTIONS: PositionOptions = {\n    maximumAge: 60 * 1000,\n    timeout: 5 * 1000,\n    enableHighAccuracy: true,\n  }\n\n  public static async getCurrentPosition(): Promise<Position> {\n    return new Promise<Position>( (resolve, reject) => {\n      window.navigator.geolocation.getCurrentPosition((position: Position) => {\n        resolve(position);\n      }, (error: PositionError) => {\n        if (DeveloperUtils.isDeveloper()) {\n          resolve(DeveloperUtils.fakePosition());\n        } else {\n          reject(error);\n        }\n      }, LocationUtils.POSITION_OPTIONS);\n    });\n  }\n}\n\nclass RunPersistence {\n  private static ENDPOINT: string = 'https://7098mtfhad.execute-api.us-west-2.amazonaws.com/Prod/WalkingSchoolBusRun';\n  private static TABLE_NAME: string = 'walking-school-bus-runs';\n\n  public static async emitRunUpdate(run: RunModel): Promise<Response> {\n    const body: string = JSON.stringify({\n      TableName: 'walking-school-bus-runs',\n      Item: {\n        school_route: run.school?.name + '_' + run.route?.name,\n        start: run.start,\n        run: run\n      }\n    });\n    return fetch(RunPersistence.ENDPOINT, {\n      method: 'POST',\n      body: body,\n      mode: 'cors'\n    });  \n  }\n\n  public static async listOpenRuns(): Promise<Array<RunModel>> {\n    return fetch(`${RunPersistence.ENDPOINT}?TableName=${RunPersistence.TABLE_NAME}`, {\n        method: 'GET',\n        mode: 'cors'\n      })\n      .then((response: Response) => response.json())\n      .then((responseJSON) => responseJSON.Items)\n      .catch((reason) => {\n        console.log('Catching listOpenRuns: ' + reason);\n        if (DeveloperUtils.isDeveloper()) {\n          return [DeveloperUtils.FAKE_RUN];\n        } else {\n          throw reason;\n        }    \n      });\n  }\n}\n\nexport {\n  DateUtils,\n  LocationUtils,\n  RunPersistence,\n}\n","import React from 'react';\nimport { SchoolModel, RouteModel } from './Models';\nimport Storage from './Storage';\n\n/** The tag properties for the SchoolChooser component */\ninterface SchoolChooserProps {\n  /** The schools for the user to choose from */\n  schools: Array<SchoolModel>\n\n  /** Callback invoked when a school is chosen */\n  callback: (school: SchoolModel) => Promise<any>\n}\n\n/** React component to allow a user to choose a School */\nclass SchoolChooser extends React.Component<SchoolChooserProps> {\n  render() {\n    const schools: Array<any> = this.props.schools.map((school) =>\n      (<div className=\"SchoolChooser-School\" key={school.name}>\n        <button onClick={() => this.props.callback(school)}>{school.name}</button>\n      </div>)\n    );\n    return (<div className=\"SchoolChooser\">\n      Choose a school:\n      <div className=\"SchoolChooser-Schools\">{schools}</div>\n    </div>);\n  }\n}\n\n/** The tag properties for the RouteChooser component */\ninterface RouteChooserProps {\n  /** The routes for the user to choose from */\n  routes: Array<RouteModel>\n\n  /** Callback invoked when a route is chosen */\n  callback: (route: RouteModel) => Promise<any>\n}\n\n/** React component to allow a user to choose a Route */\nclass RouteChooser extends React.Component<RouteChooserProps> {\n  render() {\n    const routes: Array<any> = this.props.routes.map((route)=>\n      (<div className=\"RouteChooser-Route\" key={route.name}>\n        <button onClick={() => this.props.callback(route)}>{route.name}</button>\n      </div>)\n    );\n    return (<div className=\"RouteChooser\">\n      Choose a route:\n      <div className=\"RouteChooser-Routes\">{routes}</div>\n    </div>);\n  }\n}\n\n/** Is the LeaderChooser component specifying the first leader, or adding one? */\nexport enum LeaderChooserMode {\n  First,\n  Add\n}\n\n/** The tag properties for the LeaderChooser component */\ninterface LeaderChooserProps {\n  /** The mode of the chooser, toggling the messages */\n  mode: LeaderChooserMode\n\n  /** Callback invoked when a leader is chosen */\n  callback: (leader: string) => Promise<any>\n}\n\n/** React component to allow a user to specify the leader name */\nclass LeaderChooser extends React.Component<LeaderChooserProps> {\n  static LEADER_STORAGE_KEY: string = 'leader';\n\n  private getCachedLeaderName(): string | null {\n    return Storage.get(LeaderChooser.LEADER_STORAGE_KEY);\n  }\n\n  private cacheLeaderName(leader: string): void {\n    Storage.put(LeaderChooser.LEADER_STORAGE_KEY, leader);\n  }\n\n  private async onButtonPress() {\n    const cached = this.getCachedLeaderName() || 'Anonymous';\n    let message: string = 'Who is leading the route?';\n    if (this.props.mode === LeaderChooserMode.Add) {\n      message = 'Who is joining as a leader?';\n    }\n    const leader = prompt(message, cached) || 'Anonymous';\n    if (leader !== 'Anonymous') {\n      this.cacheLeaderName(leader);\n    }\n    this.props.callback(leader);\n  }\n\n  render() {\n    let message: string = 'Start Route';\n    if (this.props.mode === LeaderChooserMode.Add) {\n      message = 'Add Leader';\n    }\n    return (<button onClick={() => this.onButtonPress()}>{message}</button>);\n  }\n}\n\nexport {\n  SchoolChooser,\n  RouteChooser,\n  LeaderChooser,\n}\n","/** Utility class to encapsulate short term storage */\nexport default class Storage {\n\n  /** Retrieve the value from storage for the key, or undefined if not present */\n  public static get(key: string): string | null {\n    return localStorage.getItem(key);\n  }\n\n  /** Save the value in storage under the provided key */\n  public static put(key: string, value: string): void {\n    localStorage.setItem(key, value);\n  }\n}\n","import React from 'react';\nimport './App.css';\nimport { DateUtils, LocationUtils, RunPersistence } from './Utils';\n\nimport { SchoolModel, RouteModel, BusLeader, StopModel, RunModel, StopArrivalModel } from './Models';\nimport { SchoolChooser, RouteChooser, LeaderChooser, LeaderChooserMode } from './Choosers';\nimport { ArrivedStop, NextStop, PendingStop } from './Stops';\nimport SCHOOLS from './Schools';\n\ntype AppProps = {}\n\nenum AppMode {\n  LEAD, WATCH\n};\n\ntype AppState = RunModel & {\n  mode: AppMode,\n  previous: Array<RunModel>,\n  watch?: NodeJS.Timeout,\n};\n\nconst initialState = {\n  mode: AppMode.WATCH,\n  leaders: new Array<BusLeader>(),\n  arrivals: new Array<StopArrivalModel>(),\n  previous: new Array<RunModel>(),\n};\n\nexport default class App extends React.Component<AppProps, AppState> {\n  readonly state: AppState = initialState;\n\n  componentDidMount() {\n    RunPersistence.listOpenRuns().then((previous: Array<RunModel>) => this.onPreviousRuns(previous));\n  }\n\n  componentWillUnmount() {\n    this.stopWatch();\n  }\n\n  private startWatch() {\n    if (this.state.watch === undefined) {\n      const watch = setInterval( () => {\n        if (this.state.mode === AppMode.LEAD) {\n          this.stopWatch();\n        } else {\n          RunPersistence.listOpenRuns().then((previous: Array<RunModel>) => this.onPreviousRuns(previous));\n        }\n      }, 15 * 1000);\n      this.setState({ watch: watch });\n    }\n  }\n\n  private stopWatch() {\n    if (this.state.watch) {\n      clearInterval(this.state.watch);\n      this.setState({ watch: undefined });\n    }\n  }\n\n  private async onPreviousRuns(previous: Array<RunModel>) {\n    this.setState({ previous: previous });\n  }\n\n  private async onPreviousJoin(leader: string, run: RunModel) {\n    this.setState({ mode: AppMode.LEAD });\n    this.setState(run);\n    this.onLeaderAdded(leader);\n    this.stopWatch();\n  }\n\n  private async onCreateNew() {\n    this.setState({ mode: AppMode.LEAD });\n    this.stopWatch();\n  }\n\n  private get previous(): any {\n    let previous: any = this.state.previous.map((run, i) => {\n      const leaders = run.leaders\n        .map((leader) => leader.name)\n        .join(', ');\n      const start = run.start?.toISOString();\n      const lastStop = run.arrivals[run.arrivals.length - 1]?.stop.name;\n      return (<div className=\"Previous-Run\" key={i + ''}>\n        <div className=\"Previous-Name\">{run.school?.name} - {run.route?.name}</div>\n        <div className=\"Previous-Start\">{start}</div>\n        <div className=\"Previous-Leaders\">{leaders}</div>\n        <div className=\"Previous-LastStop\">Last Stop: {lastStop}</div>\n        <div className=\"Previous-Buttons\">\n          <LeaderChooser mode={LeaderChooserMode.Add} callback={(leader:string) => this.onPreviousJoin(leader, run)}/> - <button onClick={() => this.startWatch()}>Watch</button>\n        </div>\n      </div>);\n    });\n    if (previous.length === 0) {\n      previous = 'None';\n    }\n    return (<div className=\"Previous\">\n        <div className=\"Previous-Runs\">\n          Open Runs: {previous}\n        </div>\n        <hr/>\n        <button onClick={() => this.onCreateNew()}>Create New Run</button>\n      </div>);\n  }\n\n  /** Async handler to record the school chosen in the run model */\n  private async onSchoolChosen(school: SchoolModel): Promise<any> {\n    this.setState({ school: school });\n  }\n\n  /** Convenience method, either renders the school chooser, or the chosen school */\n  private get school(): any {\n    if (!this.state.school) {\n      return (<SchoolChooser\n        schools={SCHOOLS}\n        callback={(school: SchoolModel) => this.onSchoolChosen(school)}\n        />);\n    }\n    return (<div className=\"Run-School\">School: {this.state.school.name}</div>);\n  }\n\n  /** Async handler to record the route chosen in the run model */\n  private async onRouteChosen(route: RouteModel): Promise<any> {\n    this.setState({ route: route });\n  }\n\n  /** Convenience method, either renders the route chooser for the school or the chosen route */\n  private get route(): any {\n    if (!this.state.school) {\n      return '';\n    } else if (!this.state.route) {\n      return (<RouteChooser\n        routes={this.state.school.routes}\n        callback={(route: RouteModel) => this.onRouteChosen(route)}\n        />);\n    }\n    return (<div className=\"Run-Route\">Route: {this.state.route.name}</div>);\n  }\n\n  /** Async handler to record that a leader has been specified, starting the run if necessary */\n  private async onLeaderChosen(leader: string): Promise<any> {\n    this.setState( {\n      leaders: [{ name: leader }],\n      start: new Date(),\n      mode: AppMode.LEAD,\n    }, () => RunPersistence.emitRunUpdate(this.state));\n  }\n\n  private async onLeaderAdded(leader: string): Promise<any> {\n    this.setState( (state, props) => {\n      return { leaders: state.leaders.concat({ name: leader }) };\n    }, () => RunPersistence.emitRunUpdate(this.state));\n\n  }\n\n  /** Async handler to remove a leader from the run */\n  private async onLeaderRemoved(leaderIndex: number): Promise<any> {\n    this.setState( (state, props) => {\n      return { leaders: state.leaders.filter((_, index) => index !== leaderIndex) };\n    }, () => RunPersistence.emitRunUpdate(this.state));\n  }\n\n  /** Convenience method, either renders the start route button or the current leader */\n  private get leader(): any {\n    if (!this.state.school || !this.state.route) {\n      return '';\n    } else if (this.state.leaders.length === 0) {\n      return (<LeaderChooser mode={LeaderChooserMode.First} callback={(leader:string) => this.onLeaderChosen(leader)}/>);\n    }\n    const numLeaders = this.state.leaders.length;\n    const leaders: Array<any> = this.state.leaders.map((leader, i) => {\n      let removeButton: any = '';\n      if (numLeaders > 1) {\n        const index = i;\n        removeButton = (<span>&nbsp;<button onClick={() => this.onLeaderRemoved(index)}>X</button></span>);\n      }\n      return (<div className=\"Run-Leader\" key={leader.name + i}>\n        {leader.name}\n        {removeButton}\n        </div>);\n    });\n    return (<div className=\"Run-Leaders\">\n      Leaders: {leaders}\n      <LeaderChooser mode={LeaderChooserMode.Add} callback={(leader:string) => this.onLeaderAdded(leader)}/>\n      </div>);\n  }\n\n  /** Convenience method, renders the start time of the run if it has started */\n  private get start(): any {\n    if (!this.state.start) {\n      return '';\n    }\n\n    return (<div className=\"Run-Start\">Start: {this.state.start.toISOString()}</div>);\n  }\n\n  /** Async handler, records an arrival at a stop in the run model */\n  private async onArrival(stop: StopModel): Promise<any> {\n    const here = await LocationUtils.getCurrentPosition();\n    this.setState( (state, props) => {\n      const now = DateUtils.now();\n      return {\n        arrivals: state.arrivals.concat({\n          stop: stop,\n          timestamp: now,\n          position: here,\n        })\n      };\n    }, () => {\n      if (this.state.route && this.state.arrivals.length === this.state.route.stops.length) {\n        this.setState({ end: DateUtils.now() }, () => RunPersistence.emitRunUpdate(this.state));\n      } else {\n        RunPersistence.emitRunUpdate(this.state);\n      }\n    });\n  }\n\n  /** Most of the magic is here, renders the different stops along the route with their current state */\n  private get stops(): any {\n    if (!this.state.route || !this.state.start) {\n      return '';\n    }\n    const elements: Array<any> = [];\n    // Loop through all stops that we've already arrived at\n    let i = 0;\n    for (; i < this.state.arrivals.length; i++) {\n      const arrival = this.state.arrivals[i];\n      elements.push((<ArrivedStop arrival={arrival} key={i + ''}/>));\n    }\n\n    // Render the next stop along the route\n    const nextStop = this.state.route.stops[i];\n    if (nextStop) {\n      elements.push((<NextStop stop={nextStop} onArrival={(stop: StopModel) => this.onArrival(stop)} key={i + ''}/>));\n      i++;\n    }\n\n    // Render any pending steps remaining in the route\n    while (i < this.state.route.stops.length) {\n      const stop = this.state.route.stops[i];\n      elements.push((<PendingStop stop={stop} key={i + ''}/>));\n      i++;\n    }\n    return elements;\n  }\n\n  /** Convenience method, renders the end time of the run, if any */\n  private get end(): any {\n    if (!this.state.end) {\n      return '';\n     }\n    return (<div className=\"Run-End\">End: {this.state.end.toISOString()}</div>);\n  }\n\n  /** Triggers a file download of the current run's data */\n  private async onDownloadPressed(): Promise<any> {\n    const options: BlobPropertyBag = { type: 'application/json' };\n    const blob: Blob = new Blob([JSON.stringify(this.state)], options);\n    const element = document.createElement('a');\n    element.setAttribute('href', window.URL.createObjectURL(blob));\n    const filename = this.state.school?.name + '-' + this.state.route?.name + '-' + this.state.start?.toISOString() + '.json';\n    element.setAttribute('download', filename);\n    element.style.display = 'none';\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n  }\n\n  /** Convenience method, renders a download button if the run is done */\n  private get download(): any {\n    if (!this.state.end) {\n      return '';\n    }\n\n    return (<button onClick={() => this.onDownloadPressed()}>Download Data</button>)\n  }\n\n  render() {\n    let body;\n    if (this.state.mode === AppMode.WATCH) {\n      body = this.previous;      \n    } else if (this.state.mode === AppMode.LEAD) {\n      body = (<div className=\"Run\">\n        {this.school}\n        {this.route}\n        {this.leader}\n        {this.start}\n        {this.stops}\n        {this.end}\n        {this.download}\n      </div>);\n    }\n\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <p>Walking School Bus</p>\n        </header>\n        {body}\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { StopModel, StopArrivalModel } from './Models';\n\ntype ArrivedStopParams = {\n  arrival: StopArrivalModel\n}\n\ntype StopParams = {\n  stop: StopModel\n}\n\ntype ArrivableStopParams = {\n  onArrival: (stop: StopModel) => Promise<any>\n}\n\n/** A react component to render a stop for which the school bus has already arrived */\nclass ArrivedStop extends React.Component<ArrivedStopParams> {\n  render() {\n    return (<div className=\"ArrivedStop\">\n        <div className=\"ArrivedStop-Header\">Arrived at Stop</div>\n        <div className=\"ArrivedStop-Name\">{this.props.arrival.stop.name}</div>\n        <div className=\"ArrivedStop-Timestamp\">{this.props.arrival.timestamp.toISOString()}</div>\n        <div className=\"ArrivedStop-Position\">Lat: {this.props.arrival.position.coords.latitude}, Lon: {this.props.arrival.position.coords.longitude}, Alt: {this.props.arrival.position.coords.altitude}</div>\n      </div>);\n  }\n}\n\n/** A react component to render the next stop along the route for a particular run */\nclass NextStop extends React.Component<StopParams & ArrivableStopParams> {\n  render() {\n    return (<div className=\"NextStop\">\n        <hr/>\n        <div className=\"NextStop-Header\">Next Stop</div>\n        <div className=\"NextStop-Name\">{this.props.stop.name}</div>\n        <div className=\"NextStop-Arrive\">\n          <button onClick={() => this.props.onArrival(this.props.stop)}>Arrive!</button>\n        </div>\n        <hr/>\n      </div>);\n  }\n}\n\n/** A react component to render a stop along the route that the bus has not yet reached (and is not next) */\nclass PendingStop extends React.Component<StopParams> {\n  render() {\n    return (<div className=\"PendingStop\">\n        <div className=\"PendingStop-Header\">Pending Stop</div>\n        <div className=\"PendingStop-Name\">{this.props.stop.name}</div>\n      </div>);\n  }\n}\n\nexport {\n  ArrivedStop,\n  NextStop,\n  PendingStop,\n}","import { SchoolModel } from './Models';\n\n/**\n * The current list of all schools, routes, and stops.\n *\n * TODO: This should probably be converted to some other datastore that\n *     can be managed independent of source control, perhaps keeping this\n *     as a set of defaults or test data.\n * TODO: Think about creating common objects for shared stops like 'School'\n */\nconst SCHOOLS: Array<SchoolModel> = [{\n  name: 'Bailey Gatzert',\n  routes: [\n    {\n      name: 'Jefferson',\n      stops: [\n        { name: '20th Ave and East Jefferson St' },\n        { name: '12th Ave and East Jefferson St' },\n        { name: '12th Ave and East Alder St' },\n        { name: 'School' },\n      ]\n    },\n    {\n      name: 'Yesler',\n      stops: [\n        { name: '19th Ave and East Yesler Way' },\n        { name: '17th Ave and East Yesler Way' },\n        { name: '15th Ave and East Yesler Way' },\n        { name: 'School' },\n      ]\n    }\n  ]\n}];\n\nexport default SCHOOLS;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}